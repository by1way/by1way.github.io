<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title> | By1way</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '23548c5ffb96043176d784e058b0ea36';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">By1way</h1><a id="logo" href="/.">By1way</a><p class="description">用心记录每一份成长、每一滴收获、每一个新奇</p></div><div id="nav-menu"><a href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"></h1><div class="post-content"><h3 id="redis持久化的意义在哪儿"><a href="#redis持久化的意义在哪儿" class="headerlink" title="redis持久化的意义在哪儿"></a>redis持久化的意义在哪儿</h3><p>持久化的意义在故障恢复。redis的数据如果单单是放到内存中，是没有任何办法应对一些灾难性故障的。</p>
<p>持久化之后又是如何应对故障的发生的呢？通过持久化+远程备份的方式来应对一些灾难性的故障。</p>
<p>总结：如果没有持久，在遇到灾难的时候就会丢失全部数据。如果通过持久化将数据搞一份到磁盘上去，然后定期比如同步和备份到云存储服务上去，那么就可以保证数据不会全部丢失，还是可以恢复一部分数据回来。</p>
<p>持久化，数据备份+灾难恢复</p>
<p>redis持久化，RDB,AOF的区别，各自特点是什么，适合什么样的场景？</p>
<p>企业持久化方案是什么，是用来跟哪些 企业级场景结合起来使用的</p>
<h4 id="RDB和AOF两种持久化机制的介绍"><a href="#RDB和AOF两种持久化机制的介绍" class="headerlink" title="RDB和AOF两种持久化机制的介绍"></a>RDB和AOF两种持久化机制的介绍</h4><pre><code>对于一个企业级的redis架构，持久化是必不可少的。
企业级redis架构：海量数据、高并发、高可用
持久化主要是做灾难恢复、数据恢复，也可以归类到高可用的一个环节里去的。比如在遇到缓存雪崩的时候，所有请求都打到了数据库上。一下子就挂了，这是很严重的故障
持久化机制：RDB、AOF
RDB持久化机制：对redis里面的数据进行周期性持久化。每隔一段时间，生成内存中数据的一份完整快照
AOF:redis拿到每条数据，都会写到AOF文件里。现在操作文件中，写文件不是直接写磁盘，会先写操作系统的缓存，到一定时间再从缓存到磁盘上。
fsync操作，强制将oscache中的数据，刷入到磁盘文件中。每隔几秒就调用fsync()。
redis中的数据是有限量的，内存大小是一定的。到一定程度之后，redis就会采用缓存淘汰算法比如LRU,自动将一部分数据从内存中给清除。
AOF会越来越大，只有一个文件，AOF文件中存放的是每条写入的命令，当AOF大到一定程度的时候，AOF就会做rewrite操作。
AOF的rewrite操作，会基于当前redis内存中的数据，来重新构造一个更小的AOF文件，然后将旧的大文件（AOF文件)给删除
AOF文件和AOF重写文件是两个文件？还是只允许存在一个文件?我怎么记得是两个文件呀
redis通过这种rewrite的机制，来确保AOF文件大小，一直限制在内存可以存放数据的大小

可以将RDB、AOF文件备份到云服务上去，做为终极备份。
Redis重启之后 会优先使用AOF来恢复数据
</code></pre><h4 id="RDB持久化的优点"><a href="#RDB持久化的优点" class="headerlink" title="RDB持久化的优点"></a>RDB持久化的优点</h4><p>1、RDB会生成多个数据文件，每个数据文件代表了某一个时刻redis中的数据，这种多个数据文件的方式，非常适合做冷备。可以将这种完整的数据文件发送到一些远程的安全存储上去，以预定好的备份策略来定期血仇redis中的数据。RDB做冷备，可以由redis来控制固定时长来生成快照文件。AOF还需要配合一些脚本去做这个事情 。<br>2、RDB对redis对外提供的读写服务，影响非常小，可以让redis保持高性能，因为redis主线程只需要fork一个子进程，让子进程执行磁盘IO操作来进行RDB持久化即可<br>3、相对AOF持久化机制来说，直接基于RDB数据文件来重启和恢复redis，更加快速</p>
<h4 id="RDB持久化的缺点"><a href="#RDB持久化的缺点" class="headerlink" title="RDB持久化的缺点"></a>RDB持久化的缺点</h4><p>1、会丢失数据比较多<br>2、fork子进程，内存数据比较大时，会阻塞主线程</p>
<h4 id="AOF持久化的优缺点"><a href="#AOF持久化的优缺点" class="headerlink" title="AOF持久化的优缺点"></a>AOF持久化的优缺点</h4><p>可以更好的保护数据不丢失，可以配置把数据丢失控制在1秒内。</p>
<h4 id="AOF持久化的缺点"><a href="#AOF持久化的缺点" class="headerlink" title="AOF持久化的缺点"></a>AOF持久化的缺点</h4><p>1、文件比较大<br>2、对性能有影响<br>3、rewrite操作比较复杂<br>4、做数据恢复比较慢，做定期备份不太方便，需要配合脚本使用</p>
<h4 id="RDB和AOF到底该如何选择"><a href="#RDB和AOF到底该如何选择" class="headerlink" title="RDB和AOF到底该如何选择"></a>RDB和AOF到底该如何选择</h4><p>各取所长，两个都开启，AOF做为第一选择，RDB做最后一道防线</p>
<h3 id="如何配置RDB持久化"><a href="#如何配置RDB持久化" class="headerlink" title="如何配置RDB持久化"></a>如何配置RDB持久化</h3><p>在redis.conf文件。<br>save 60 1000<br>每隔60s,如果有超过1000个key发生了变更 ，那么就生成一个新的dump.rdb文件，这就是当前redis内存中完整的数据快照，这个操作也被称为snapshotting,也可以手动调用save或bgsave，同步或异步生成快照文件。<br>save可以设置多个，就是多个snapshotting检查点，每到一个检查点，就会去check一下，是事有指定key数据发生了变更 。<br>save 60 10000<br>save 300 10<br>save 900 1</p>
<p>采用redis-cli shutdown命令从客户端来操作redis，其实这是一种安全的退出模式，redis在退出的时候会自动将内存中的数据立即生成一份完整的rdb快照。</p>
<h4 id="RDB持久化流程"><a href="#RDB持久化流程" class="headerlink" title="RDB持久化流程"></a>RDB持久化流程</h4><ol>
<li>redis根据配置自己去尝试生成rdb快照文件</li>
<li>fork一个子进程出来</li>
<li>子进程尝试将数据dump到rdb快照文件中</li>
<li>完成rdb快照文件的生成之后 ，就替换之前旧的快照文件</li>
</ol>
</div></div><div id="lv-container" data-id="city" data-uid="MTAyMC80MzczNi8yMDI3NQ=="><script>(function(d, s) {
   var j, e = d.getElementsByTagName(s)[0];
   if (typeof LivereTower === 'function') { return; }
   j = d.createElement(s);
   j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
   j.async = true;
   e.parentNode.insertBefore(j, e);
})(document, 'script');
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/NoSQL数据/">NoSQL数据</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/attendance/">attendance</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/专业英语/">专业英语</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/专栏学习/">专栏学习</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/分享/">分享</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/宝库/">宝库</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/文档服务器/">文档服务器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构师视角/">架构师视角</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构师训练营/">架构师训练营</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构探索/">架构探索</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书/">读书</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/重启/">重启</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/原始分布式时代/" style="font-size: 15px;">原始分布式时代</a> <a href="/tags/重启/" style="font-size: 15px;">重启</a> <a href="/tags/单体系统/" style="font-size: 15px;">单体系统</a> <a href="/tags/SOA时代/" style="font-size: 15px;">SOA时代</a> <a href="/tags/后微服务时代/" style="font-size: 15px;">后微服务时代</a> <a href="/tags/无服务时代/" style="font-size: 15px;">无服务时代</a> <a href="/tags/微服务时代/" style="font-size: 15px;">微服务时代</a> <a href="/tags/远程服务调用/" style="font-size: 15px;">远程服务调用</a> <a href="/tags/ARTS/" style="font-size: 15px;">ARTS</a> <a href="/tags/Link/" style="font-size: 15px;">Link</a> <a href="/tags/资源/" style="font-size: 15px;">资源</a> <a href="/tags/课堂笔记/" style="font-size: 15px;">课堂笔记</a> <a href="/tags/分享/" style="font-size: 15px;">分享</a> <a href="/tags/Map/" style="font-size: 15px;">Map</a> <a href="/tags/Echarts/" style="font-size: 15px;">Echarts</a> <a href="/tags/阅读/" style="font-size: 15px;">阅读</a> <a href="/tags/FastDFS/" style="font-size: 15px;">FastDFS</a> <a href="/tags/分布式文档服务器/" style="font-size: 15px;">分布式文档服务器</a> <a href="/tags/存储系统/" style="font-size: 15px;">存储系统</a> <a href="/tags/事务处理/" style="font-size: 15px;">事务处理</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/RESTful服务/" style="font-size: 15px;">RESTful服务</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/04/30/15-事务处理/">15.事务处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/29/14-事务处理/">14.事务处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/28/13-事务处理/">13.事务处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/27/12-事务处理/">12.事务处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/26/11-事务处理/">11.事务处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/25/10-RESTful服务/">10.RESTful服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/24/09-RESTful服务/">09.RESTful服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/31/32-point/">32-point</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/07/08-远程服务调用/">08.远程服务调用</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/07/07-远程服务调用/">07.远程服务调用</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://wild2pro.com/" title="写程序的厨子" target="_blank">写程序的厨子</a><ul></ul><a href="https://lilyssh.cn/" title="lilyssh(新认识的一个技术牛人)" target="_blank">lilyssh(新认识的一个技术牛人)</a><ul></ul><a href="https://www.byway.xyz/" title="我自己" target="_blank">我自己</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">By1way.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Carol.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>